const imagePaths = [
    { src: "img/diag1.jpg", isTarget: false },
    { src: "img/diag2.jpg", isTarget: true },
    { src: "img/blan.jpg", isTarget: false },
    { src: "img/blan.jpg", isTarget: false },
    { src: "img/diag3.jpg", isTarget: true },
    { src: "img/blan.jpg", isTarget: false },
    { src: "img/blan.jpg", isTarget: false },
    { src: "img/diag4.jpg", isTarget: true },
    { src: "img/diag5.jpg", isTarget: false }
];

const grid = document.querySelector('.grid');
const validateBtn = document.getElementById('validateBtn');
const resultMessage = document.getElementById('resultMessage');
const nextTestLink = document.getElementById('nextTestLink'); // SÃ©lection du lien

imagePaths.forEach((imgObj, index) => {
    const img = document.createElement('img');
    img.src = imgObj.src;
    img.dataset.isTarget = imgObj.isTarget;
    img.dataset.index = index;
    img.addEventListener('click', () => {
        img.classList.toggle('selected');
    });
    grid.appendChild(img);
});

function arraysEqual(arr1, arr2) {
    return JSON.stringify(arr1.sort((a, b) => a - b)) === JSON.stringify(arr2.sort((a, b) => a - b)); // Comparaison correcte
}

const nextTestBtn = document.getElementById('nextTestBtn'); // SÃ©lection du bouton

validateBtn.addEventListener('click', () => {
    const selectedImages = document.querySelectorAll('.grid img.selected');
    const selectedIndexes = Array.from(selectedImages).map(img => parseInt(img.dataset.index));

    const correctIndexes = imagePaths
        .map((img, i) => (img.isTarget ? i : null))
        .filter(i => i !== null);

    if (arraysEqual(selectedIndexes, correctIndexes)) {
        resultMessage.textContent = "yes, here!";
        resultMessage.style.color = "green";
        
        startCelebration(); // ðŸŽ‰ DÃ©clencher la pluie d'images !
    } else {
        resultMessage.textContent = "not here...";
        resultMessage.style.color = "red";
        
        // Cacher le bouton si l'utilisateur s'est trompÃ©
        nextTestBtn.style.display = 'none';
    }
});

function startCelebration() {
    function createFallingImage() {
        const img = document.createElement("img");
        img.src = "img/eclair.png"; // Remplace par ton image de cÃ©lÃ©bration
        img.classList.add("falling-image");

        // Position alÃ©atoire sur l'Ã©cran
        img.style.left = `${Math.random() * window.innerWidth}px`;
        img.style.top = `-50px`; // Commence au-dessus de l'Ã©cran

        document.body.appendChild(img);

        // Animation vers le bas avec une durÃ©e alÃ©atoire
        setTimeout(() => {
            img.style.transform = `translateY(${window.innerHeight}px) rotate(${Math.random() * 360}deg)`;
            img.style.opacity = "0"; // Disparition progressive
        }, Math.random() * 3000 + 2000); // Entre 2s et 5s de chute

        // Supprime l'image aprÃ¨s un certain temps
        setTimeout(() => {
            img.remove();
        }, 10000); // Assure que lâ€™image disparaÃ®t aprÃ¨s 6s
    }

    // Lancer une image toutes les 300-800ms pour un effet continu
    setInterval(() => {
        createFallingImage();
    }, Math.random() * 500 + 300);
}

